# 更新日志 (Changelog)

## [1.0.3] - 2025-05-25

### 🐛 修复 (Fixed)
- **彻底解决自动更新后的Python DLL加载问题**：
  - 重构了自动更新器的初始化时机，从MainWindow构造函数移到showEvent
  - 添加了强化的qasync事件循环检查机制
  - 实现了渐进式重试机制，确保事件循环完全稳定后才初始化自动更新器
  - 解决了手动启动和自动更新启动之间的初始化时机差异问题

### 🔧 改进 (Improved)
- **自动更新器稳定性大幅提升**：
  - 添加了多重检查：事件循环类型、运行状态、窗口可见性
  - 实现了最多5次的智能重试机制，避免资源竞争
  - 优化了启动检查的触发时机，确保在自动更新器完全初始化后才开始
  - 增强了日志记录，便于问题诊断和调试

### 🏗️ 架构 (Architecture)
- 改进了主窗口的初始化流程，确保组件按正确顺序初始化
- 优化了异步任务的管理，避免qasync和asyncio事件循环冲突
- 增强了错误处理和恢复机制

---

## [1.0.2] - 2025-05-25

### 🐛 修复 (Fixed)
- 修复了完整业务场景集成测试中的两个关键问题：
  - 会话结束时锁屏功能测试逻辑错误（业务层不应包含UI操作）
  - 数学练习奖励机制测试中的数据库方法调用错误
- 完善了测试中的异步Mock配置，解决了数据库操作的异步调用问题

### 🧪 测试 (Testing)
- 所有集成测试现在都能正常通过（5/5 测试通过）
- 改进了测试的Mock配置，增加了对缓存解释功能的支持
- 优化了测试断言逻辑，更准确地反映实际的系统行为

### 📚 文档 (Documentation)
- 澄清了两个`end_session`方法的不同职责和作用：
  - `logic/game_limiter.py`：核心业务逻辑层，负责数据处理
  - `ui/main_window.py`：UI控制层，负责界面更新和锁屏操作
- 完善了事件日志系统与传统日志系统的关系说明

### 🏗️ 架构 (Architecture)
- 确认了分层架构设计的合理性：
  - 业务层专注数据处理和业务规则
  - UI层专注用户交互和界面更新
  - 锁屏功能正确地放置在UI层而非业务层

---

## [1.0.1] - 2025-05-24

### ✨ 新增 (Added)
- 完整的事件日志系统，支持结构化JSON日志记录
- 统一日志系统，支持传统日志向事件日志的渐进式迁移
- 全面的集成测试套件，覆盖主要业务场景

### 🔧 改进 (Improved)
- 优化了数学练习的奖励机制
- 改进了监控系统的事件记录
- 增强了会话管理的日志记录

---

## [1.0.0] - 2025-05-23

### 🎉 首次发布 (Initial Release)
- 游戏时间限制和管理功能
- 数学练习奖励系统
- 窗口监控和自动锁屏
- 管理员面板和设置管理
- 自动更新检查功能 