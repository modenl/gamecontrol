# 奖励系统更新总结

## 更新概述
根据用户要求，已成功调整数学练习的奖励系统，使奖励时间更加合理：
- **简单题**: 0.5分钟
- **最难竞赛题**: 5分钟  
- **奖励时间约为做题时间的一半**
- **支持小数奖励时间**

## 主要改动

### 1. GPT生成题目的Prompt调整
- 修改了`logic/math_exercises.py`中的奖励时间指导
- 新的奖励分配：
  - 0.5分钟：非常简单的计算，基础算术（1-2分钟做题时间）
  - 1分钟：简单问题，需要一步计算（2-3分钟做题时间）
  - 1.5分钟：需要两步的问题（3分钟做题时间）
  - 2分钟：中等复杂度，需要推理（4分钟做题时间）
  - 2.5分钟：多步骤问题（5分钟做题时间）
  - 3分钟：复杂问题，需要深度思考（6分钟做题时间）
  - 4分钟：高难度多步骤问题（8分钟做题时间）
  - 5分钟：最具挑战性的竞赛级问题（10分钟做题时间）

### 2. 数据库升级
- 添加了`_upgrade_to_v6()`方法
- 将`reward_minutes`字段从INTEGER改为REAL类型
- 支持小数奖励时间的存储和检索

### 3. 代码兼容性更新
- 修改所有默认奖励时间从2分钟改为1.0分钟
- 更新UI显示代码以正确格式化小数奖励时间
- 修改信号定义支持float类型参数
- 更新常量文件中的默认值

### 4. UI显示优化
- 奖励时间显示：整数时不显示小数点，小数时显示一位小数
- 例如：`1 minute` 而不是 `1.0 minute`，`1.5 minutes` 保持小数显示
- 更新了奖励信息说明窗口

## 测试结果

运行`test_reward_system.py`的测试结果：

```
✓ 成功生成 10 道题目
✓ 奖励时间范围正确 (0.5-5分钟)
✓ 包含小数奖励时间
✓ 小数奖励时间存储正确
✓ 奖励计算返回数值类型
```

### 实际生成的题目奖励分配示例：
- 题目1 (难度1): 0.5分钟 - 简单算术
- 题目2 (难度1): 1分钟 - 几何周长计算
- 题目3 (难度1): 0.5分钟 - 基础运算
- 题目4 (难度1): 0.5分钟 - 简单方程
- 题目5 (难度2): 2分钟 - 三角形面积
- 题目6 (难度2): 2分钟 - 数论问题
- 题目7 (难度2): 2.5分钟 - 排列组合
- 题目8 (难度2): 1.5分钟 - 概率计算
- 题目9 (难度3): 3分钟 - 几何证明
- 题目10 (难度4): 5分钟 - 数列问题

**总奖励时间**: 18.5分钟（相比之前的20-50分钟大幅减少）

## 文件修改清单

### 核心逻辑文件
- `logic/math_exercises.py` - 更新GPT prompt和默认值
- `logic/database.py` - 添加数据库升级支持小数
- `logic/constants.py` - 更新默认奖励时间常量

### UI文件
- `ui/math_panel_simple.py` - 更新显示格式和默认值
- `ui/math_panel.py` - 更新显示格式和默认值
- `ui/main_window.py` - 更新信号类型支持float

### 测试文件
- `test_reward_system.py` - 新增测试文件验证功能

## 向后兼容性
- 现有数据库记录会自动升级
- 旧的整数奖励时间仍然有效
- UI能正确显示新旧两种格式的奖励时间

## 用户体验改进
1. **更合理的奖励时间**: 奖励时间现在真正反映题目难度和所需时间
2. **精确的时间分配**: 支持0.5分钟这样的精确奖励
3. **更好的激励机制**: 简单题快速奖励，难题给予充分奖励
4. **总时间控制**: 每日总奖励时间从20-50分钟降低到15-25分钟范围

这次更新成功实现了用户的要求，使奖励系统更加科学合理，既保持了激励效果，又避免了过度奖励的问题。 